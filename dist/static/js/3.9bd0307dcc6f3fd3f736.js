webpackJsonp([3],{"3Wgx":function(e,t){},ZSsr:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("RxVx"),s={name:"demoTree",data:function(){return{templateDialog:this.demoTreeDialogVisible,data2:[{id:1,label:"group1",children:[{id:4,label:"group2",children:[{id:9,label:"user2-1"},{id:10,label:"user2-2"}]},{id:11,label:"group5",children:[{id:12,label:"user5-1"},{id:13,label:"user5-2"}]}]},{id:2,label:"group3",children:[{id:5,label:"user3-1"},{id:6,label:"user3-2"}]},{id:3,label:"group4",children:[{id:7,label:"user4-1"},{id:8,label:"user4-2"}]}],defaultProps:{children:"children",label:"label"}}},props:{demoTreeDialogVisible:{type:Boolean,default:!1},taskId:{type:String,default:""}},watch:{demoTreeDialogVisible:function(){this.templateDialog=this.demoTreeDialogVisible}},methods:{saveData:function(){var e=this;(this.$refs.tree.getCheckedNodes().length=0)&&this.$message.warning("Please choose the user you want to delegate to.");var t={action:"delegate",assignee:e.$refs.tree.getCheckedNodes()[0].label};this.$axios.post(this.$api.flowableapi+"runtime/tasks/"+e.taskId,t,{}).then(function(t){200!==t.status&&e.$message.error(t.statusText)}).catch(function(t){e.$message.error(t.toString())}),this.templateDialog=!1},closeDia:function(){this.$emit("update:demoTreeDialogVisible",!1)},checkChange:function(e,t,a){if(this.multiple)return!1;if(!0===t){if(this.editCheckId=e.id,e.disabled)return!1;this.$refs.tree.setCheckedKeys([e.id])}else if(this.editCheckId===e.id){if(e.disabled)return!1;this.$refs.tree.setCheckedKeys([e.id])}},nodeClick:function(e,t,a){return!this.multiple&&(this.editCheckId=e.id,!e.disabled&&void this.$refs.tree.setCheckedKeys([e.id]))}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{attrs:{width:"30%",top:"150px",showClose:!1,visible:e.templateDialog,center:""},on:{"update:visible":function(t){e.templateDialog=t},close:e.closeDia}},[a("el-row",[a("el-col",[a("el-tree",{ref:"tree",attrs:{data:e.data2,"show-checkbox":"","default-expand-all":"","node-key":"id","highlight-current":"",props:e.defaultProps},on:{"check-change":e.checkChange,"node-click":e.nodeClick}})],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"}},[a("el-button",{attrs:{type:"primary",size:"medium"},on:{click:e.saveData}},[e._v("确定")]),e._v(" "),a("el-button",{attrs:{size:"medium"},on:{click:function(t){e.templateDialog=!1}}},[e._v("取消")])],1)],1)],1)],1)},staticRenderFns:[]};var n=a("VU/8")(s,o,!1,function(e){a("tVX1")},"data-v-bf15098a",null).exports,r={name:"task",components:{imgDialog:i.a,demoTree:n},data:function(){return{imgDialogVisible:!1,demoTreeDialogVisible:!1,processDefinitionId:null,processInstanceId:null,decidedType:null,dealingTaskId:null,form:{orderCode:null,processName:null,taskName:null,processFinished:!1,createTimeRange:[],dueTimeRange:[],finishedTimeRange:[],taskType:"myTask"},tableData:{pageNo:1,pageSize:10,totalCount:0,list:[]},dealingData:null,pickerOptions2:{shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:"最近三个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}}]}}},methods:{handleSizeChange:function(e){this.tableData.pageSize=e,this.findData()},handlePrevChange:function(e){this.tableData.pageNo=e},handleNextChange:function(e){this.tableData.pageNo=e},handleCurrentChange:function(e){this.tableData.pageNo=e,this.findData()},findData:function(){switch(this.form.taskType){case"myTask":case"claimingTask":this.findDealingTask();break;case"historyTask":this.findHistoryTask()}},findDealingTask:function(){var e=this,t={processInstanceBusinessKeyLike:this.form.orderCode,nameLike:this.form.taskName,processDefinitionNameLike:this.form.processName,createdAfter:this.form.createTimeRange[0],createdBefore:this.form.createTimeRange[1],dateAfter:this.form.dueTimeRange[0],dueBefore:this.form.dueTimeRange[1]};switch(this.form.taskType){case"myTask":t.assigneeLike=this.$store.state.app.user.passport;break;case"claimingTask":t.unassigned=!0,t.candidateUser=this.$store.state.app.user.passport}this.$axios.post(this.$api.flowableapi+"query/tasks",t,{params:{sort:"createTime",order:"desc",start:this.start,size:this.tableData.pageSize}}).then(function(t){200!=t.status&&e.$message.error(t.statusText);for(var a=t.data.data,i=function(t){e.$axios.get(a[t].processDefinitionUrl,{}).then(function(i){e.$set(a[t],"processName",i.data.name),e.$set(a[t],"productName",i.data.category)}),e.$axios.get(a[t].processInstanceUrl,{}).then(function(i){e.$set(a[t],"orderCode",i.data.businessKey)})},s=0;s<a.length;s++)i(s);e.tableData.list=a,e.tableData.totalCount=t.data.total}).catch(function(t){e.$message.error(t.toString())})},findHistoryTask:function(){var e=this,t={processBusinessKeyLike:this.form.orderCode,taskNameLike:this.form.taskName,processDefinitionNameLike:this.form.processName,taskCreatedAfter:this.form.createTimeRange[0],taskCreatedBefore:this.form.createTimeRange[1],dueDateAfter:this.form.dueTimeRange[0],dueDateBefore:this.form.dueTimeRange[1],taskCompletedAfter:this.form.finishedTimeRange[0],taskCompletedBefore:this.form.finishedTimeRange[1],finished:!0,processFinished:this.form.processFinished,taskAssignee:this.$store.state.app.user.passport};this.$axios.post(this.$api.flowableapi+"query/historic-task-instances",t,{params:{sort:"startTime",order:"desc",start:this.start,size:this.tableData.pageSize}}).then(function(t){200!=t.status&&e.$message.error(t.statusText);for(var a=t.data.data,i=function(t){e.$axios.get(a[t].processDefinitionUrl,{}).then(function(i){e.$set(a[t],"processName",i.data.name),e.$set(a[t],"productName",i.data.category)}),e.$axios.get(a[t].processInstanceUrl,{}).then(function(i){e.$set(a[t],"orderCode",i.data.businessKey)})},s=0;s<a.length;s++)i(s);e.tableData.list=a,e.tableData.totalCount=t.data.total}).catch(function(t){e.$message.error(t.toString())})},dealTask:function(e){var t=this;this.$axios.post(this.$api.flowableapi+"runtime/tasks/"+t.dealingData.id,{action:e,assignee:t.$store.state.app.user.passport},{}).then(function(e){200!=e.status&&t.$message.error(e.statusText),t.$message.success(e.statusText)}).catch(function(e){t.$message.error(e.toString())})},delegateTask:function(){this.dealingData?(this.dealingTaskId=this.dealingData.id,this.demoTreeDialogVisible=!0):this.$message.warning("Please choose the data you want to deal.")},taskTypeChanged:function(){this.tableData.pageNo=0,this.tableData.pageSize=10,this.findData()},handleCurrentRowChange:function(e){this.dealingData=e},dealServiceDataWithoutParam:function(){this.dealingData?this.$router.push(""+this.dealingData.category+this.dealingData.orderCode+"/"+this.dealingData.id+"/"+this.dealingData.processInstanceId):this.$message.warning("Please choose the data you want to deal.")},dealServiceData:function(e,t,a,i){console.log(""+e+t+"/"+a+"/"+i),this.$router.push(""+e+t+"/"+a+"/"+i)},getDiagramWithoutParamByInstanceId:function(){this.dealingData?(this.decidedType="instance",this.processDefinitionId=null,this.processInstanceId=this.dealingData.processInstanceId,this.imgDialogVisible=!0):this.$message.warning("Please choose the data you want to deal.")},getDiagramWithoutParamByDefinitionId:function(){this.dealingData?(this.decidedType="definition",this.processInstanceId=null,this.processDefinitionId=this.dealingData.processDefinitionId,this.imgDialogVisible=!0):this.$message.warning("Please choose the data you want to deal.")},getDiagramByInstanceId:function(e){this.decidedType="instance",this.processDefinitionId=null,this.processInstanceId=e,this.imgDialogVisible=!0},getDiagramByDefinitionId:function(e){console.log(e),this.decidedType="definition",this.processInstanceId=null,this.processDefinitionId=e,this.imgDialogVisible=!0}},computed:{start:function(){return(this.tableData.pageNo-1)*this.tableData.pageSize}},created:function(){""!=this.$route.params.ordercode&&"null"!=this.$route.params.ordercode&&null!=this.$route.params.ordercode&&(this.form.orderCode=this.$route.params.ordercode),this.findData()}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",[a("el-form",{ref:"form",attrs:{model:e.form,inline:!0,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"订单号",prop:"orderCode"}},[a("el-input",{model:{value:e.form.orderCode,callback:function(t){e.$set(e.form,"orderCode",t)},expression:"form.orderCode"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"任务名称",prop:"taskName"}},[a("el-input",{model:{value:e.form.taskName,callback:function(t){e.$set(e.form,"taskName",t)},expression:"form.taskName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"流程名称",prop:"processName"}},[a("el-input",{model:{value:e.form.processName,callback:function(t){e.$set(e.form,"processName",t)},expression:"form.processName"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"finished"}},["historyTask"==e.form.taskType?a("el-switch",{attrs:{"active-text":"已结束流程","inactive-text":"进行中流程","active-color":"#ff4949","inactive-color":"#13ce66"},model:{value:e.form.processFinished,callback:function(t){e.$set(e.form,"processFinished",t)},expression:"form.processFinished"}}):e._e()],1),e._v(" "),a("el-form-item",{attrs:{label:"创建时间",prop:"createTimeRange"}},[a("div",{staticClass:"block"},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions2},model:{value:e.form.createTimeRange,callback:function(t){e.$set(e.form,"createTimeRange",t)},expression:"form.createTimeRange"}})],1)]),e._v(" "),a("el-form-item",{attrs:{label:"过期时间",prop:"dueTimeRange"}},[a("div",{staticClass:"block"},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions2},model:{value:e.form.dueTimeRange,callback:function(t){e.$set(e.form,"dueTimeRange",t)},expression:"form.dueTimeRange"}})],1)]),e._v(" "),a("el-form-item",{attrs:{label:"结束时间",prop:"finishedTimeRange"}},[a("div",{staticClass:"block"},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions2},model:{value:e.form.finishedTimeRange,callback:function(t){e.$set(e.form,"finishedTimeRange",t)},expression:"form.finishedTimeRange"}})],1)]),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.findData}},[e._v("查询")]),e._v(" "),a("el-button",{on:{click:function(t){e.$refs.form.resetFields()}}},[e._v("重置")])],1)],1)],1),e._v(" "),a("el-row",[a("el-tabs",{on:{"tab-click":e.taskTypeChanged},model:{value:e.form.taskType,callback:function(t){e.$set(e.form,"taskType",t)},expression:"form.taskType"}},[a("el-tab-pane",{attrs:{label:"我的任务",name:"myTask"}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-zoom-in"},on:{click:function(t){e.getDiagramWithoutParamByInstanceId()}}},[e._v("查看流程详情")]),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-loading"},on:{click:e.dealServiceDataWithoutParam}},[e._v("进入办理")]),e._v(" "),a("el-button",{attrs:{type:"danger",icon:"el-icon-service"},on:{click:e.delegateTask}},[e._v("委托")]),e._v(" "),a("el-button",{attrs:{icon:"el-icon-star-off"},on:{click:function(t){e.dealTask("resolve")}}},[e._v("释放")]),e._v(" "),a("el-button",{attrs:{type:"success",icon:"el-icon-check"},on:{click:function(t){e.dealTask("complete")}}},[e._v("完成")])],1),e._v(" "),a("el-tab-pane",{attrs:{label:"可认领任务",name:"claimingTask"}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-zoom-in"},on:{click:function(t){e.getDiagramWithoutParamByInstanceId()}}},[e._v("查看流程详情")]),e._v(" "),a("el-button",{attrs:{type:"warning",icon:"el-icon-star-on"},on:{click:function(t){e.dealTask("claim")}}},[e._v("认领")])],1),e._v(" "),a("el-tab-pane",{attrs:{label:"历史任务",name:"historyTask"}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-zoom-in"},on:{click:function(t){e.getDiagramWithoutParamByDefinitionId()}}},[e._v("查看流程详情")])],1)],1)],1),e._v(" "),a("el-row",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData.list,"highlight-current-row":"",border:""},on:{"current-change":e.handleCurrentRowChange}},[a("el-table-column",{attrs:{type:"index",label:"序号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"orderCode",label:"订单号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"任务名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"processName",label:"流程名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"productName",label:"关联商品"}}),e._v(" "),a("el-table-column",{attrs:{prop:"assignee",label:"执行人"}}),e._v(" "),"historyTask"!=e.form.taskType?[a("el-table-column",{attrs:{prop:"createTime",label:"创建时间"}}),e._v(" "),a("el-table-column",{attrs:{prop:"dueDate",label:"过期时间"}})]:e._e(),e._v(" "),"historyTask"==e.form.taskType?[a("el-table-column",{attrs:{prop:"startTime",label:"创建时间"}}),e._v(" "),a("el-table-column",{attrs:{prop:"endTime",label:"结束时间"}})]:e._e(),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return["historyTask"!=e.form.taskType?a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){e.getDiagramByInstanceId(t.row.processInstanceId)}}},[e._v("查看流程详情")]):e._e(),e._v(" "),"historyTask"==e.form.taskType?a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){e.getDiagramByDefinitionId(t.row.processDefinitionId)}}},[e._v("查看流程详情")]):e._e(),e._v(" "),"myTask"==e.form.taskType?a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){e.dealServiceData(t.row.category,t.row.orderCode,t.row.id,t.row.processInstanceId)}}},[e._v("进入办理")]):e._e()]}}])})],2),e._v(" "),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{"current-page":e.tableData.pageNo,"page-size":e.tableData.pageSize,"page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:e.tableData.totalCount},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"prev-click":e.handlePrevChange,"next-click":e.handleNextChange}})],1)],1),e._v(" "),a("imgDialog",{attrs:{imgDialogVisible:e.imgDialogVisible,processInstanceId:e.processInstanceId,processDefinitionId:e.processDefinitionId,decidedType:e.decidedType},on:{"update:imgDialogVisible":function(t){e.imgDialogVisible=t}}}),e._v(" "),a("demoTree",{attrs:{demoTreeDialogVisible:e.demoTreeDialogVisible,taskId:e.dealingTaskId},on:{"update:demoTreeDialogVisible":function(t){e.demoTreeDialogVisible=t}}})],1)},staticRenderFns:[]};var c=a("VU/8")(r,l,!1,function(e){a("3Wgx")},"data-v-900050b8",null);t.default=c.exports},tVX1:function(e,t){}});
//# sourceMappingURL=3.9bd0307dcc6f3fd3f736.js.map