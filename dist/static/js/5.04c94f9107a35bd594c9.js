webpackJsonp([5],{"9kHU":function(e,t){},ITBd:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s={name:"startProcess",data:function(){return{templateDialog:this.templateVisible,formData:{orderCode:null,processDefinitionId:null},processDefinitionList:[{name:"专利-发明专用流程",id:"1",version:21}]}},props:{templateVisible:{type:Boolean,default:!1}},watch:{templateVisible:function(){this.templateDialog=this.templateVisible}},methods:{closeDia:function(){this.$emit("update:templateVisible",!1)},openDia:function(){var e=this;this.$axios.get(this.$api.flowableapi+"repository/process-definitions",{params:{size:500}}).then(function(t){e.processDefinitionList=t.data.data}).catch(function(t){e.$message.error(t.toString())})},startProcess:function(){var e=this;this.$axios.post(this.$api.flowableapi+"runtime/process-instances",{processDefinitionId:this.formData.processDefinitionId,businessKey:this.formData.orderCode},{}).then(function(t){201!==t.status?e.$message.error(t.statusText):(e.$message.success(t.statusText),e.formData.orderCode=null,e.formData.processDefinitionId=null,e.templateDialog=!1)}).catch(function(t){e.$message.error(t.toString())})}}},n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:"启动流程",width:"30%",top:"150px","close-on-click-modal":!1,visible:e.templateDialog,center:!0},on:{close:e.closeDia,open:e.openDia}},[a("el-form",{ref:"formData",attrs:{model:e.formData,"label-width":"130px",size:"large"}},[a("el-form-item",{attrs:{label:"订单号："}},[a("el-input",{model:{value:e.formData.orderCode,callback:function(t){e.$set(e.formData,"orderCode",t)},expression:"formData.orderCode"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"业务分类："}},[a("el-select",{attrs:{placeholder:"请选择流程"},model:{value:e.formData.processDefinitionId,callback:function(t){e.$set(e.formData,"processDefinitionId",t)},expression:"formData.processDefinitionId"}},e._l(e.processDefinitionList,function(t){return a("el-option",{key:t.name,attrs:{label:t.name,value:t.id}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.name))]),e._v(" "),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.version))])])}))],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.templateDialog=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.startProcess()}}},[e._v("启 动")])],1)],1)},staticRenderFns:[]};var i=a("VU/8")(s,n,!1,function(e){a("9kHU")},"data-v-1fda5455",null).exports,o=a("IcnI"),r={props:{url:String},data:function(){return{}},watch:{url:function(){this.getData()}},methods:{getBase64Image:function(e){var t=this;window.URL=window.URL||window.webkitURL;var a=new XMLHttpRequest;a.open("get",e,!0);var s=o.a.state.user.passport+":"+o.a.state.user.passwd,n="Basic "+btoa(encodeURIComponent(s).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}));a.responseType="blob",a.setRequestHeader("Authorization",n),a.onload=function(){if(200==this.status){var e=this.response,a=new FileReader;a.onloadend=function(e){e.target.result},a.readAsDataURL(e);var s=document.createElement("img");s.onload=function(e){window.URL.revokeObjectURL(s.src)};var n=window.URL.createObjectURL(e);s.src=n,t.$refs.imgDiv.innerHTML="",t.$refs.imgDiv.appendChild(s)}},a.send()},getData:function(){this.getBase64Image(this.url)}},mounted:function(){this.getData()}},l={render:function(){var e=this.$createElement;return(this._self._c||e)("div",{ref:"imgDiv"})},staticRenderFns:[]},c={name:"process",components:{startProcess:i,imgDialog:a("VU/8")(r,l,!1,null,null,null).exports},data:function(){return{activeName:"first",templateVisible:!1,imgDialogVisible:!1,processDefinitionId:null,processInstanceId:null,form:{key:"40026961",orderCode:null,processName:null,productName:null,finished:!1,startTimeRange:[],endTimeRange:[]},result:{processDefinitionKey:"1",businessKey:"2",variableInfos:[],processDetails:[]},tableData:{pageNo:1,pageSize:10,totalCount:0,list:[]}}},created:function(){this.findData()},computed:{start:function(){return(this.tableData.pageNo-1)*this.tableData.pageSize},imageSrc:function(){return this.$api.deploymentApi+"diagram?processInstanceId="+this.form.key}},methods:{handleSizeChange:function(e){this.tableData.pageSize=e,this.findData()},handleCurrentChange:function(e){this.tableData.pageNo=e,this.findData()},handlePrevChange:function(e){this.tableData.pageNo=e},handleNextChange:function(e){this.tableData.pageNo=e},findData:function(){var e=this;this.$axios.get(this.$api.deploymentApi+"debug?processInstanceId="+e.form.key,{headers:{"Content-Type":"application/json"}}).then(function(t){e.result=t.data.data,e.tableData.list=t.data.data.list,e.tableData.totalCount=t.data.data.total}).catch(function(t){e.$message.error(t.toString())})},getDiagramByInstanceId:function(e){this.processInstanceId=e,this.imgDialogVisible=!0},getDiagramByDefinitionId:function(e){this.processDefinitionId=e,this.imgDialogVisible=!0},cancelProcessInstance:function(e){var t=this;this.$axios.delete(this.$api.flowableapi+"runtime/process-instances/"+e,{}).then(function(e){204!==e.status?t.$message.error(e.statusText):(t.$message.success("deleted"),t.findData())}).catch(function(e){t.$message.error(e.toString())})},turnToTask:function(e){this.$router.push("/home/workbench/task/"+e)}}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",[a("el-form",{ref:"form",attrs:{model:e.form,inline:!0,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"流程实例",prop:"key"}},[a("el-input",{model:{value:e.form.key,callback:function(t){e.$set(e.form,"key",t)},expression:"form.key"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.findData}},[e._v("查询")])],1)],1)],1),e._v(" "),a("el-row",[e._v("\n            流程定义："+e._s(e.result.processDefinitionKey)+"，业务主键："+e._s(e.result.businessKey)+"\n        ")]),e._v(" "),[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"执行流水",name:"first"}},[a("el-row",[a("el-table",{attrs:{data:e.result.processDetails,border:""}},[a("el-table-column",{attrs:{type:"index",label:"NO."}}),e._v(" "),a("el-table-column",{attrs:{prop:"startTime",label:"开始时间"}}),e._v(" "),a("el-table-column",{attrs:{prop:"endTime",label:"结束时间"}}),e._v(" "),a("el-table-column",{attrs:{prop:"activityId",label:"环节ID"}}),e._v(" "),a("el-table-column",{attrs:{prop:"activityName",label:"环节名称"}}),e._v(" "),a("el-table-column",{attrs:{label:"环节类型"},scopedSlots:e._u([{key:"default",fn:function(t){return["userTask"===t.row.activityType?a("span",[e._v("人工环节")]):"httpServiceTask"===t.row.activityType?a("span",[e._v("Http环节")]):"sequenceFlow"===t.row.activityType?a("span",[e._v("分支")]):"startEvent"===t.row.activityType?a("span",[e._v("开始")]):"exclusiveGateway"===t.row.activityType?a("span",[e._v("网关")]):a("span",[e._v(e._s(t.row.activityType))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return["finished"===t.row.type?a("span",[e._v("已完成")]):a("span",[e._v("执行中")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"claimTime",label:"领取时间"},scopedSlots:e._u([{key:"default",fn:function(t){return["userTask"===t.row.activityType?a("span",[e._v(e._s(t.row.claimTime))]):a("span",[e._v("-")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"assignee",label:"领取人"},scopedSlots:e._u([{key:"default",fn:function(t){return["userTask"===t.row.activityType?a("span",[e._v(e._s(t.row.assignee))]):a("span",[e._v("-")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"requestUrl",label:"请求url"},scopedSlots:e._u([{key:"default",fn:function(t){return["userTask"===t.row.activityType?a("span",[e._v(e._s(t.row.requestUrl))]):"httpServiceTask"===t.row.activityType?a("span",[e._v(e._s(t.row.requestUrl))]):a("span",[e._v("-")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"requestBody",label:"body表达式"},scopedSlots:e._u([{key:"default",fn:function(t){return["userTask"===t.row.activityType?a("span",[e._v(e._s(t.row.requestBody))]):"httpServiceTask"===t.row.activityType?a("span",[e._v(e._s(t.row.requestBody))]):a("span",[e._v("-")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"responseValue",label:"请求返回值"},scopedSlots:e._u([{key:"default",fn:function(t){return["userTask"===t.row.activityType?a("span",[e._v(e._s(t.row.responseValue))]):"httpServiceTask"===t.row.activityType?a("span",[e._v(e._s(t.row.responseValue))]):a("span",[e._v("-")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"error",label:"异常信息"},scopedSlots:e._u([{key:"default",fn:function(t){return["userTask"===t.row.activityType?a("span",[e._v(e._s(t.row.error))]):"httpServiceTask"===t.row.activityType?a("span",[e._v(e._s(t.row.error))]):a("span",[e._v("-")])]}}])})],1)],1)],1),e._v(" "),a("el-tab-pane",{attrs:{label:"变量表",name:"second"}},[a("el-row",[a("el-table",{attrs:{data:e.result.variableInfos,border:""}},[a("el-table-column",{attrs:{type:"index",label:"NO."}}),e._v(" "),a("el-table-column",{attrs:{prop:"key",label:"变量名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"value",label:"变量值"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                    "+e._s(t.row.value)+"\n                                ")]}}])})],1)],1)],1),e._v(" "),a("el-tab-pane",{attrs:{label:"流程图",name:"third"}},[a("imgDialog",{attrs:{url:e.imageSrc}})],1)],1)],e._v(" "),a("startProcess",{attrs:{templateVisible:e.templateVisible},on:{"update:templateVisible":function(t){e.templateVisible=t}}})],2)},staticRenderFns:[]};var u=a("VU/8")(c,p,!1,function(e){a("wmyA")},"data-v-666a96d4",null);t.default=u.exports},wmyA:function(e,t){}});
//# sourceMappingURL=5.04c94f9107a35bd594c9.js.map